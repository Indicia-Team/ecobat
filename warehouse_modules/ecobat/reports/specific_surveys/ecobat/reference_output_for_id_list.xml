<report
    title="Reference output basic"
    description="Basic output of a reference range calculation for a range of static bat detector record nights."
>
  <query>
    select fullset.id, fullset.date_start as night, cttl.preferred_taxon as species, fullset.passes, fullset.percentile
    from (
      select id, date_start, taxa_taxon_list_id, passes, percent_rank() over (order by passes) as percentile
      from ecobat_occurrences o
      where 1=1
      #filters#
    ) as fullset
    join cache_taxa_taxon_lists cttl on cttl.id=fullset.taxa_taxon_list_id
    where id in (#id_list#)
  </query>  
  <order_bys>
    <order_by>o.date_start</order_by>
  </order_bys>
  <params>
    <param name="map_sq_10km_id_list" display="Map square list" description="List of 10km map squares to include" datatype="integer[]" default="" >
      <where>map_sq_10km_id in (#idlist#)</where>
    </param>
    <param name="limit_time_of_year_from" display="Limit day in year from" description="Limit to records from this day number in the year" datatype="integer" default="" >
      <where>o.day_of_year&gt;=#limit_time_of_year_from#</where>
    </param>
    <param name="limit_time_of_year_to" display="Limit day in year to" description="Limit to records up to this day number in the year" datatype="integer" default="" >
      <where>o.day_of_year&lt;=#limit_time_of_year_to#</where>
    </param>
    <param name="id_list" display="" description="List of ecobat occurrence record IDs to compare against the reference range" datatype="integer" />
  </params>
</report>

